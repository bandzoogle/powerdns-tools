#!/usr/bin/env ruby
require 'rubygems'
require 'optparse'

opts = OptionParser.new
opts.on('-s', '--server [ARG]')    { |s| Powerdns.server = s }
opts.on('-t', '--template [ARG]')    { |zt| @zone_name = zt }
opts.parse!(ARGV)

local_path = File.join(File.dirname(__FILE__), '../', 'lib/powerdns-tools')
if File.exist?("#{local_path}.rb")
  puts "using local copy of code for testing"
  require local_path
else
  gem 'powerdns-tools'
end

raise "Please setup site_base/api_key" unless Powerdns.site_base && Powerdns.api_key

data = ARGF.collect { |line|
  # filter lines that start with comments
  line unless line[0,1] == ";"
}.join("").strip

puts Powerdns::ZoneTemplate.from_zonefile(data, @zone_name)
